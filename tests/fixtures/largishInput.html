<!DOCTYPE html>
<html>
	<head>
		<title>PresideCMS Documentation :: Data objects</title>
		<base href="../">

		<meta content="initial-scale=1.0, width=device-width" name="viewport">

		<link href="assets/css/base.min.css" rel="stylesheet">
		<link href="assets/css/project.css" rel="stylesheet">
		<link href="assets/css/highlight.css" rel="stylesheet">
		<link rel="icon" type="image/png" href="assets/images/preside-favicon.png">



		<!-- ie -->
		<!--[if lt IE 9]>
			<script src="assets/js/html5shiv.js" type="text/javascript"></script>
			<script src="assets/js/respond.js" type="text/javascript"></script>
		<![endif]-->
	</head>

	<body class="page">
		<nav class="menu menu-left nav-drawer" id="menu">
			<div class="menu-scroll">
				<div class="menu-wrap">
					<div class="menu-content">
						<a class="nav-drawer-logo" href="index.html"><img src="assets/images/logo-preside.png"></a>
						<ul class="nav">








				<li class=" ">

					<a href="quickstart.html">Quick start guide</a>






				</li>





				<li class="active ">

					<a href="devguides.html">Developer guides</a>






						<span class="menu-collapse-toggle " data-target="#devguides" data-toggle="collapse" aria-expanded="true">
							<i class="icon icon-close menu-collapse-toggle-close"></i>
							<i class="icon icon-add menu-collapse-toggle-default"></i>
						</span>
						<ul class="menu-collapse expand" id="devguides">







								<li class="active"><a href="devguides/dataobjects.html">Data objects</a></li>





								<li><a href="devguides/dataobjectviews.html">Data object views</a></li>





								<li><a href="devguides/viewlets.html">Viewlets</a></li>





								<li><a href="devguides/workingwithpagetypes.html">Working with page types</a></li>





								<li><a href="devguides/workingwithmultiplesites.html">Working with multiple sites</a></li>





								<li><a href="devguides/workingwiththericheditor.html">Working with the richeditor</a></li>





								<li><a href="devguides/routing.html">Routing</a></li>





								<li><a href="devguides/cmspermissioning.html">CMS permissioning</a></li>





								<li><a href="devguides/websiteusersandpermissioning.html">Website users and permissioning</a></li>





								<li><a href="devguides/editablesystemsettings.html">Editable system settings</a></li>





								<li><a href="devguides/emailtemplating.html">Email centre</a></li>





								<li><a href="devguides/notifications.html">Notifications</a></li>





								<li><a href="devguides/customerrorpages.html">Custom error pages &amp; maintenance mode</a></li>





								<li><a href="devguides/sitetreenavigationmenus.html">Sitetree navigation menus</a></li>





								<li><a href="devguides/adminlefthandmenu.html">Modifying the administrator left hand menu</a></li>





								<li><a href="devguides/workingwithuploadedfiles.html">Working with uploaded files</a></li>





								<li><a href="devguides/multilingualcontent.html">Multilingual content</a></li>





								<li><a href="devguides/presidesuperclass.html">Using the super class</a></li>





								<li><a href="devguides/configurableconsolekey.html">Configuring the developer console key</a></li>





								<li><a href="devguides/assetmanager.html">Working with the asset manager</a></li>





								<li><a href="devguides/xss.html">XSS protection</a></li>





								<li><a href="devguides/restframework.html">REST framework</a></li>





								<li><a href="devguides/formbuilder.html">Working with the form builder</a></li>





								<li><a href="devguides/spreadsheets.html">Working with spreadsheets</a></li>





								<li><a href="devguides/sessions.html">Session management and stateless requests</a></li>





								<li><a href="devguides/validationframework.html">Validation framework</a></li>





								<li><a href="devguides/adminapplications.html">Creating multiple admin applications</a></li>





								<li><a href="devguides/presideforms.html">Forms system</a></li>





								<li><a href="devguides/i18n.html">i18n</a></li>





								<li><a href="devguides/taskmanager.html">Task manager</a></li>





								<li><a href="devguides/auditing.html">Using the audit trail system</a></li>





								<li><a href="devguides/widgets.html">Widgets</a></li>





								<li><a href="devguides/rulesengine.html">Rules engine</a></li>





								<li><a href="devguides/drafts.html">Drafts system</a></li>





								<li><a href="devguides/datatenancy.html">Configuring data tenancy</a></li>





								<li><a href="devguides/labelrenderers.html">Label renderers</a></li>





								<li><a href="devguides/dataexporters.html">Data exports</a></li>





								<li><a href="devguides/csrf.html">CSRF Protection</a></li>





								<li><a href="devguides/datamanager.html">Data Manager</a></li>





								<li><a href="devguides/fullpagecaching.html">Full page caching</a></li>





								<li><a href="devguides/cloning.html">Record cloning</a></li>





								<li><a href="devguides/healthchecks.html">External service health checks</a></li>





								<li><a href="devguides/adminloginproviders.html">Admin login providers</a></li>



						</ul>

				</li>





				<li class=" ">

					<a href="contribguides.html">Contributor guides</a>






						<span class="menu-collapse-toggle collapsed" data-target="#contribguides" data-toggle="collapse" aria-expanded="0">
							<i class="icon icon-close menu-collapse-toggle-close"></i>
							<i class="icon icon-add menu-collapse-toggle-default"></i>
						</span>
						<ul class="menu-collapse collapse" id="contribguides">





								<li><a href="contribguides/buildfromsource.html">Building Preside locally</a></li>





								<li><a href="contribguides/runningtests.html">Running the test suite</a></li>





								<li><a href="contribguides/submittingchanges.html">Submitting fixes, improvements and awesome new features</a></li>





								<li><a href="contribguides/branchingmodel.html">Our git branching model and release strategy</a></li>



						</ul>

				</li>





				<li class=" ">

					<a href="serverguides.html">Server setup guides</a>






						<span class="menu-collapse-toggle collapsed" data-target="#serverguides" data-toggle="collapse" aria-expanded="0">
							<i class="icon icon-close menu-collapse-toggle-close"></i>
							<i class="icon icon-add menu-collapse-toggle-default"></i>
						</span>
						<ul class="menu-collapse collapse" id="serverguides">





								<li><a href="serverguides/serversetupfoundation.html">Manual install of Preside in (almost) any environment</a></li>



						</ul>

				</li>





				<li class=" ">

					<a href="reference.html">Reference docs</a>






						<span class="menu-collapse-toggle collapsed" data-target="#reference" data-toggle="collapse" aria-expanded="0">
							<i class="icon icon-close menu-collapse-toggle-close"></i>
							<i class="icon icon-add menu-collapse-toggle-default"></i>
						</span>
						<ul class="menu-collapse collapse" id="reference">





								<li><a href="reference/api.html">System service APIs</a></li>





								<li><a href="reference/presideobjects.html">System Preside Objects</a></li>





								<li><a href="reference/systemforms.html">System form layouts</a></li>





								<li><a href="reference/systemformcontrols.html">System form controls</a></li>



						</ul>

				</li>





				<li class=" ">

					<a href="upgradenotes.html">Upgrade notes</a>






				</li>





				<li class=" ">

					<a href="docs.html">About the docs</a>






						<span class="menu-collapse-toggle collapsed" data-target="#about" data-toggle="collapse" aria-expanded="0">
							<i class="icon icon-close menu-collapse-toggle-close"></i>
							<i class="icon icon-add menu-collapse-toggle-default"></i>
						</span>
						<ul class="menu-collapse collapse" id="about">





								<li><a href="docs/content.html">Content</a></li>





								<li><a href="docs/build.html">Build</a></li>



						</ul>

				</li>


	</ul>
						<hr>
						<ul class="nav">
							<li>
								<a href="http://www.presidecms.com"><span class="fa fa-fw fa-globe"></span>PresideCMS Website</a>
							</li>
							<li>
								<a href="https://github.com/pixl8/Preside-CMS"><span class="fa fa-fw fa-github"></span>Source repository</a>
							</li>
							<li>
								<a href="download.html"><span class="fa fa-fw fa-download"></span>Offline docs</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</nav>

		<header class="header">
			<ul class="hidden-lg nav nav-list pull-left">
				<li>
					<a class="menu-toggle" href="#menu">
						<span class="access-hide">Menu</span>
						<span class="icon icon-menu icon-lg"></span>
						<span class="header-close icon icon-close icon-lg"></span>
					</a>
				</li>
			</ul>
			<a class="header-logo hidden-lg" href="index.html"><img alt="PresideCMS" src="assets/images/logo-preside-reverse.png"></a>
			<ul class="nav nav-list pull-right">



					<li>
						<a href="/devguides.html">
							<span class="access-hide">Previous page: Developer guides</span>
							<span class="icon icon-arrow-back icon-lg"></span>
						</a>
					</li>


					<li>
						<a href="/devguides/dataobjectviews.html">
							<span class="access-hide">Previous page: Data object views</span>
							<span class="icon icon-arrow-forward icon-lg"></span>
						</a>
					</li>

				<li>
					<a class="menu-toggle" href="#search">
						<span class="access-hide">Search</span>
						<span class="icon icon-search icon-lg"></span>
						<span class="header-close icon icon-close icon-lg"></span>
					</a>
				</li>
			</ul>
			<span class="header-fix-show header-logo pull-none text-overflow">Data objects</span>
		</header>
		<div class="menu menu-right menu-search" id="search">
			<div class="menu-scroll">
				<div class="menu-wrap">
					<div class="menu-content">
						<div class="menu-content-inner">
							<label class="access-hide" for="presidecms-docs-search-input">Search</label>
							<input class="form-control form-control-lg menu-search-focus" id="presidecms-docs-search-input" placeholder="Search" type="search">
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="content">
			<div class="content-heading">
				<div class="container">
					<div class="row">
						<div class="col-lg-10 col-lg-push-1">
							<h1 class="heading">Data objects</h1>
						</div>
					</div>
				</div>
			</div>

			<div class="content-inner">
				<div class="container">
					<div class="row">
						<div class="col-lg-10 col-lg-push-1 body">


							<div class="tile-wrap">
								<div class="tile">
									<ul class="breadcrumb margin-no-top margin-right margin-no-bottom margin-left">
			<li><a href="index.html">Home</a></li>

				<li><a href="devguides.html">Developer guides</a></li>

			<li class="active">Data objects</li>
		</ul>
								</div>
							</div>
							<nav class="toc-navigation">
		<h2 class="toc-navigation-title">Table of contents</h2>
		<ul class="toc-list toc-list-level-1">











				<li>
					<a href="#overview">Overview</a>

				</li>

				<li>
					<a href="#object-cfc-files">Object CFC Files</a>

						<ul class="toc-list toc-list-level-2">











				<li>
					<a href="#database-table-names">Database table names</a>

				</li>

				<li>
					<a href="#registering-objects">Registering objects</a>

						<ul class="toc-list toc-list-level-3">











				<li>
					<a href="#extensions-and-core-objects">Extensions and core objects</a>

				</li>



						</ul>

				</li>



						</ul>

				</li>

				<li>
					<a href="#properties">Properties</a>

						<ul class="toc-list toc-list-level-2">











				<li>
					<a href="#standard-attributes">Standard attributes</a>

				</li>

				<li>
					<a href="#default-properties">Default properties</a>

						<ul class="toc-list toc-list-level-3">











				<li>
					<a href="#the-id-field">The ID Field</a>

				</li>

				<li>
					<a href="#the-label-field">The Label field</a>

				</li>

				<li>
					<a href="#the-datecreated-and-datemodified-fields">The DateCreated and DateModified fields</a>

				</li>



						</ul>

				</li>

				<li>
					<a href="#default-values-for-properties">Default values for properties</a>

						<ul class="toc-list toc-list-level-3">











				<li>
					<a href="#dynamic-defaults">Dynamic defaults</a>

				</li>



						</ul>

				</li>

				<li>
					<a href="#generated-fields">Generated fields</a>

				</li>

				<li>
					<a href="#formula-fields">Formula fields</a>

						<ul class="toc-list toc-list-level-3">











				<li>
					<a href="#formula-prefix-token">Formula ${prefix} token</a>

				</li>



						</ul>

				</li>

				<li>
					<a href="#enum-properties">ENUM properties</a>

				</li>

				<li>
					<a href="#defining-relationships-with-properties">Defining relationships with properties</a>

						<ul class="toc-list toc-list-level-3">











				<li>
					<a href="#one-to-many-relationships">One to Many relationships</a>

				</li>

				<li>
					<a href="#many-to-many-relationships">Many to Many relationships</a>

				</li>

				<li>
					<a href="#-advanced-many-to-many-relationships">"Advanced" Many to Many relationships</a>

				</li>



						</ul>

				</li>

				<li>
					<a href="#defining-indexes-and-unique-constraints">Defining indexes and unique constraints</a>

				</li>



						</ul>

				</li>

				<li>
					<a href="#keeping-in-sync-with-the-database">Keeping in sync with the database</a>

				</li>

				<li>
					<a href="#working-with-the-api">Working with the API</a>

						<ul class="toc-list toc-list-level-2">











				<li>
					<a href="#getting-an-instance-of-the-service-api">Getting an instance of the Service API</a>

				</li>

				<li>
					<a href="#using-auto-service-objects">Using Auto Service Objects</a>

						<ul class="toc-list toc-list-level-3">











				<li>
					<a href="#getting-an-auto-service-object">Getting an auto service object</a>

				</li>



						</ul>

				</li>

				<li>
					<a href="#crud-operations">CRUD Operations</a>

						<ul class="toc-list toc-list-level-3">











				<li>
					<a href="#specifying-fields-for-selection">Specifying fields for selection</a>

				</li>

				<li>
					<a href="#filtering-data">Filtering data</a>

				</li>

				<li>
					<a href="#making-use-of-relationships">Making use of relationships</a>

				</li>

				<li>
					<a href="#caching">Caching</a>

				</li>



						</ul>

				</li>



						</ul>

				</li>

				<li>
					<a href="#extending-objects">Extending Objects</a>

				</li>

				<li>
					<a href="#versioning">Versioning</a>

						<ul class="toc-list toc-list-level-2">











				<li>
					<a href="#opting-out">Opting out</a>

				</li>

				<li>
					<a href="#interacting-with-versions">Interacting with versions</a>

				</li>

				<li>
					<a href="#many-to-many-related-data">Many-to-many related data</a>

				</li>

				<li>
					<a href="#ignoring-changes">Ignoring changes</a>

				</li>

				<li>
					<a href="#only-create-versions-on-update">Only create versions on update</a>

				</li>



						</ul>

				</li>

				<li>
					<a href="#organising-data-by-sites">Organising data by sites</a>

				</li>



		</ul>
	</nav>


	<a class="pull-right" href="https://github.com/pixl8/Preside-Documentation/blob/master/docs/02.devguides/01.dataobjects/page.md" title="Improve the docs"><i class="fa fa-pencil fa-fw"></i></a>

	<h2>Overview</h2><p><strong>Preside Data Objects</strong> are the data layer implementation for PresideCMS. Just about everything in the system that persists data to the database uses Preside Data Objects to do so.</p><p>The Preside Data Objects system is deeply integrated into the CMS:</p>
<ul>
  <li>Input forms and other administrative GUIs can be automatically generated for your preside objects</li>
  <li><a href="devguides/dataobjectviews.html">Data object views</a> provide a way to present your data to end users without the need for handler or service layers</li>
  <li>The Data Manager provides a GUI for managing your client specific data and is based on entirely on Preside Data Objects</li>
  <li>Your preside objects can have their data tied to individual <a href="devguides/workingwithmultiplesites.html">Working with multiple sites</a>, without the need for any extra programming of site filters.</li>
</ul><p>The following guide is intended as a thorough overview of Preside Data Objects. For API reference documentation, see <a href="reference/api/presideobjectservice.html">Preside Object Service</a>.</p><h2>Object CFC Files</h2><p>Data objects are represented by ColdFusion Components (CFCs). A typical object will look something like this:</p>
<div class="highlight"><pre><span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span>          <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span> <span class="nv">maxlength</span><span class="o">=</span><span class="s2">&quot;200&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;email_address&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span> <span class="nv">maxlength</span><span class="o">=</span><span class="s2">&quot;255&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span> <span class="nv">uniqueindexes</span><span class="o">=</span><span class="s2">&quot;email&quot;</span><span class="p">;</span>

    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;tags&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-many&quot;</span> <span class="nv">relatedto</span><span class="o">=</span><span class="s2">&quot;tag&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p>A singe CFC file represents a table in your database. Properties defined using the <code>property</code> tag represent fields and/or relationships on the table.</p><h3>Database table names</h3><p>By default, the name of the database table will be the name of the CFC file prefixed with <strong>pobj_</strong>. For example, if the file was <code>person.cfc</code>, the table name would be <strong>pobj_person</strong>.</p><p>You can override these defaults with the <code>tablename</code> and <code>tableprefix</code> attributes:</p>
<div class="highlight"><pre><span class="o">/**</span>
 <span class="o">*</span> <span class="err">@</span><span class="nv">tablename</span>   <span class="nv">mytable</span>
 <span class="o">*</span> <span class="err">@</span><span class="nv">tableprefix</span> <span class="nv">mysite_</span>
 <span class="o">*/</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="c">// .. etc.</span>
<span class="p">}</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>All of the preside objects that are provided by the core PresideCMS system have their table names prefixed with <strong>psys_</strong>.</p>

					</div>
				</div>
			</div>
		</div><h3>Registering objects</h3><p>The system will automatically register any CFC files that live under the <code>/application/preside-objects</code> folder of your site (and any of its sub-folders). Each .cfc file will be registered with an ID that is the name of the file without the ".cfc" extension.</p><p>For example, given the directory structure below, <em>four</em> objects will be registered with the IDs <em>blog</em>, <em>blogAuthor</em>, <em>event</em>, <em>eventCategory</em>:</p>
<div class="highlight"><pre>/application
    /preside-objects
        /blogs
            blog.cfc
            blogAuthor.cfc
        /events
            event.cfc
            eventCategory.cfc
</pre></div>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>Notice how folder names are ignored. While it is useful to use folders to organise your Preside Objects, they carry no logical meaning in the system.</p>

					</div>
				</div>
			</div>
		</div><h4>Extensions and core objects</h4><p>For extensions, the system will search for CFC files in a <code>/preside-objects</code> folder at the root of your extension.</p><p>Core system Preside Objects can be found at <code>/preside/system/preside-objects</code>.</p><h2>Properties</h2><p>Properties represent fields on your database table or mark relationships between objects (or both).</p><p>Attributes of the properties describe details such as data type, data length and validation requirements. At a minimum, your properties should define a <em>name</em>, <em>type</em> and <em>dbtype</em> attribute. For <em>varchar</em> fields, a <em>maxLength</em> attribute is also required. You will also typically need to add a <em>required</em> attribute for any properties that are a required field for the object:</p>
<div class="highlight"><pre><span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span>          <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span>  <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span> <span class="nv">maxLength</span><span class="o">=</span><span class="s2">&quot;200&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;max_delegates&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;numeric&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">;</span> <span class="c">// not required</span>
<span class="p">}</span>
</pre></div><h3>Standard attributes</h3><p>While you can add any arbitrary attributes to properties (and use them for your own business logic needs), the system will interpret and use the following standard attributes:</p>
<div class="table-resp">
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Required</th>
                <th>Default</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>name</td>                 <td>Yes</td> <td>*N/A*</td>     <td>Name of the field</td>                                                                                                                                                                                                                                               </tr>
            <tr><td>type</td>                 <td>No</td>  <td>"string"</td>  <td>CFML type of the field. Valid values: *string*, *numeric*, *boolean*, *date*</td>                                                                                                                                                                                    </tr>
            <tr><td>dbtype</td>               <td>No</td>  <td>"varchar"</td> <td>Database type of the field to be define on the database table field        </td>                                                                                                                                                                                     </tr>
            <tr><td>maxLength</td>            <td>No</td>  <td>0</td>         <td>For dbtypes that require a length specification. If zero, the max size will be used.</td>                                                                                                                                                                            </tr>
            <tr><td>required</td>             <td>No</td>  <td>**false**</td> <td>Whether or not the field is required.    </td>                                                                                                                                                                                                                       </tr>
            <tr><td>default</td>              <td>No</td>  <td>""</td>        <td>A default value for the property. Can be dynamically created, see :ref:`presideobjectsdefaults`</td>                                                                                                                                                                 </tr>
            <tr><td>indexes</td>              <td>No</td>  <td>""</td>        <td>List of indexes for the field, see :ref:`preside-objects-indexes`</td>                                                                                                                                                                                               </tr>
            <tr><td>uniqueindexes</td>        <td>No</td>  <td>""</td>        <td>List of unique indexes for the field, see :ref:`preside-objects-indexes`</td>                                                                                                                                                                                        </tr>
            <tr><td>control</td>              <td>No</td>  <td>"default"</td> <td>The default form control to use when rendering this field in a Preside Form. If set to 'default', the value for this attribute will be calculated based on the value of other attributes. See :doc:`/devguides/formcontrols` and :doc:`/devguides/formlayouts`.</td> </tr>
            <tr><td>renderer</td>             <td>No</td>  <td>"default"</td> <td>The default content renderer to use when rendering this field in a view. If set to 'default', the value for this attribute will be calculated based on the value of other attributes. (reference needed here).</td>                                                  </tr>
            <tr><td>minLength</td>            <td>No</td>  <td>*none*</td>    <td>Minimum length of the data that can be saved to this field. Used in form validation, etc. </td>                                                                                                                                                                      </tr>
            <tr><td>minValue</td>             <td>No</td>  <td>*none*</td>    <td>The minumum numeric value of data that can be saved to this field. *For numeric types only*.</td>                                                                                                                                                                    </tr>
            <tr><td>maxValue</td>             <td>No</td>  <td>*N/A*</td>     <td>The maximum numeric value of data that can be saved to this field. *For numeric types only*.</td>                                                                                                                                                                    </tr>
            <tr><td>format</td>               <td>No</td>  <td>*N/A*</td>     <td>Either a regular expression or named validation filter (reference needed) to validate the incoming data for this field</td>                                                                                                                                          </tr>
            <tr><td>pk</td>                   <td>No</td>  <td>**false**</td> <td>Whether or not this field is the primary key for the object, *one field per object*. By default, your object will have an *id* field that is defined as the primary key. See :ref:`preside-objects-default-properties` below.</td>                                   </tr>
            <tr><td>generator</td>            <td>No</td>  <td>"none"</td>    <td>Named generator for generating a value for this field when inserting/updating a record with the value of this field ommitted. See "Generated fields", below.</td>
            <tr><td>generate</td>             <td>No</td>  <td>"never"</td>   <td>If using a generator, indicates when to generate the value. Valid values are "never", "insert" and "always".</td>
            <tr><td>formula</td>              <td>No</td>  <td>""</td>        <td>Allows you to define a field that does not exist in the database, but can be selected and used in the application. This attribute should consist of arbitrary SQL to produce a value. See "Formula fields", below.</td>
            <tr><td>relationship</td>         <td>No</td>  <td>"none"</td>    <td>Either *none*, *many-to-one* or *many-to-many*. See :ref:`preside-objects-relationships`, below.</td>                                                                                                                                                                </tr>
            <tr><td>relatedTo</td>            <td>No</td>  <td>"none"</td>    <td>Name of the Preside Object that the property is defining a relationship with. See :ref:`preside-objects-relationships`, below.</td>                                                                                                                                  </tr>
            <tr><td>relatedVia</td>           <td>No</td>  <td>""</td>        <td>Name of the object through which a many-to-many relationship will pass. If it does not exist, the system will created it for you.  See :ref:`preside-objects-relationships`, below.</td>                                                                             </tr>
            <tr><td>relationshipIsSource</td> <td>No</td>  <td>**true**</td>  <td>In a many-to-many relationship, whether or not this object is regarded as the "source" of the relationship. If not, then it is regarded as the "target". See :ref:`preside-objects-relationships`, below.</td>                                                       </tr>
            <tr><td>relatedViaSourceFk</td>   <td>No</td>  <td>""</td>        <td>The name of the source object's foreign key field in a many-to-many relationship's pivot table. See :ref:`preside-objects-relationships`, below.</td>                                                                                                                </tr>
            <tr><td>relatedViaTargetFk</td>   <td>No</td>  <td>""</td>        <td>The name of the target object's foreign key field in a many-to-many relationship's pivot table. See :ref:`preside-objects-relationships`, below.</td>                                                                                                                </tr>
            <tr><td>enum</td>                 <td>No</td>  <td>""</td>        <td>The name of the configured enum to use with this field. See "ENUM properties", below.</tr>
        </tbody>
    </table>
</div><h3>Default properties</h3><p>The bare minimum code requirement for a working Preside Data Object is:</p>
<div class="highlight"><pre><span class="nv">component</span> <span class="p">{}</span>
</pre></div><p>Yes, you read that right, an "empty" CFC is an effective Preside Data Object. This is because, by default, Preside Data Objects will be automatically given <code>id</code>, <code>label</code>, <code>datecreated</code> and <code>datemodified</code> properties. The above example is equivalent to:</p>
<div class="highlight"><pre><span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;id&quot;</span>           <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span>   <span class="nv">required</span><span class="o">=</span><span class="nv">true</span> <span class="nv">maxLength</span><span class="o">=</span><span class="s2">&quot;35&quot;</span> <span class="nv">generator</span><span class="o">=</span><span class="s2">&quot;UUID&quot;</span> <span class="nv">pk</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span>        <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span>   <span class="nv">required</span><span class="o">=</span><span class="nv">true</span> <span class="nv">maxLength</span><span class="o">=</span><span class="s2">&quot;250&quot;</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;datecreated&quot;</span>  <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;date&quot;</span>   <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;datemodified&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;date&quot;</span>   <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><h4>The ID Field</h4><p>The ID field will be the primary key for your object. We have chosen to use a UUID for this field so that data migrations between databases are achievable. If, however, you wish to use an auto incrementing numeric type for this field, you could do so by overriding the <code>type</code>, <code>dbtype</code> and <code>generator</code> attributes:</p>
<div class="highlight"><pre><span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;id&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;numeric&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span> <span class="nv">generator</span><span class="o">=</span><span class="s2">&quot;increment&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p>The same technique can be used to have a primary key that does not use any sort of generator (you would need to pass your own IDs when inserting data):</p>
<div class="highlight"><pre><span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;id&quot;</span> <span class="nv">generator</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-green">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Tip</p>
						<p>Notice here that we are just changing the attributes that we want to modify (we do not specify <code>required</code> or <code>pk</code> attributes). All the default attributes will be applied unless you specify a different value for them.</p>

					</div>
				</div>
			</div>
		</div><h4>The Label field</h4><p>The <strong>label</strong> field is used by the system for building automatic GUI selectors that allow users to choose your object records.</p><p><img src="images/screenshots/object_picker_example.png" alt="Screenshot showing a record picker for a "Blog author" object" /></p><p>If you wish to use a different property to represent a record, you can use the <code>labelfield</code> attribute on your CFC, e.g.:</p>
<div class="highlight"><pre><span class="o">/**</span>
 <span class="o">*</span> <span class="err">@</span><span class="nv">labelfield</span> <span class="nv">title</span>
 <span class="o">*</span>
 <span class="o">*/</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;title&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span> <span class="nv">maxlength</span><span class="o">=</span><span class="s2">&quot;100&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
    <span class="c">// etc.</span>
<span class="p">}</span>
</pre></div><p>If you do not want your object to have a label field at all (i.e. you know it is not something that will ever be selectable, and there is no logical field that might be used as a string representation of a record), you can add a <code>nolabel=true</code> attribute to your CFC:</p>
<div class="highlight"><pre><span class="o">/**</span>
 <span class="o">*</span> <span class="err">@</span><span class="nv">nolabel</span> <span class="nv">true</span>
 <span class="o">*</span>
 <span class="o">*/</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="c">// ... etc.</span>
<span class="p">}</span>
</pre></div><h4>The DateCreated and DateModified fields</h4><p>These do exactly what they say on the tin. If you use the APIs to insert and update your records, the values of these fields will be set automatically for you.</p><h3>Default values for properties</h3><p>You can use the <code>default</code> attribute on a property tag to define a default value for a property. This value will be used during an <code>insertData()</code> operation when no value is supplied for the property. E.g.</p>
<div class="highlight"><pre><span class="nv">component</span> <span class="p">{</span>
    <span class="c">// ...</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;max_attendees&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;numeric&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">false</span> <span class="k">default</span><span class="o">=</span><span class="m">100</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><h4>Dynamic defaults</h4><p>Default values can also be generated dynamically at runtime. Currently, this comes in two flavours:</p>
<ol>
  <li>Supplying raw CFML to be evaluated at runtime</li>
  <li>Supplying the name of a method defined in your object that will be called at runtime, this method will be passed a 'data' argument that is a structure containing the data to be inserted</li>
</ol><p>For raw CFML, prefix your value with <code>cfml:</code>, e.g. <code>cfml:CreateUUId()</code>. For methods that are defined on your object, use <code>method:methodName</code>. e.g.</p>
<div class="highlight"><pre><span class="nv">component</span>  <span class="p">{</span>
    <span class="c">// ...</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;event_start_date&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;date&quot;</span>   <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;date&quot;</span>                      <span class="nv">required</span><span class="o">=</span><span class="nv">false</span> <span class="k">default</span><span class="o">=</span><span class="s2">&quot;cfml:Now()&quot;</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;slug&quot;</span>             <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span>   <span class="nv">maxlength</span><span class="o">=</span><span class="s2">&quot;200&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">false</span> <span class="k">default</span><span class="o">=</span><span class="s2">&quot;method:calculateSlug&quot;</span><span class="p">;</span>

    <span class="nv">public</span> <span class="nv">string</span> <span class="nv">function</span> <span class="nf">calculateSlug</span><span class="p">(</span> <span class="nv">required</span> <span class="nv">struct</span> <span class="nv">data</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">return</span> <span class="nf">LCase</span><span class="p">(</span> <span class="nf">ReReplace</span><span class="p">(</span> <span class="nv">data.label</span> <span class="err">?</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;\W&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>As of Preside 10.8.0, this approach is deprecated and you should use generated fields instead (see below)</p>

					</div>
				</div>
			</div>
		</div><h3>Generated fields</h3><p>As of <strong>10.8.0</strong>, generators allow you to dynamically generate the value of a property when a record is first being inserted and, optionally, when a record is updated. The <code>generate</code> attribute of a property dictates <em>when</em> to use a generator. Valid values are:</p>
<ul>
  <li><code>never</code> (default), never generate the value</li>
  <li><code>insert</code>, only generate a value when a record is first inserted</li>
  <li><code>always</code>, generate a value on both insert and update of records</li>
</ul><p>The <code>generator</code> attribute itself then allows you to use a system pre-defined generator or use your own by prefixing the generator with <code>method:</code> (the method name that follows should be defined on your object). For example:</p>
<div class="highlight"><pre><span class="nv">component</span> <span class="p">{</span>
    <span class="c">// ...</span>

    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;alternative_pk&quot;</span>   <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span> <span class="nv">maxlength</span><span class="o">=</span><span class="m">35</span> <span class="nv">generate</span><span class="o">=</span><span class="s2">&quot;insert&quot;</span> <span class="nv">generator</span><span class="o">=</span><span class="s2">&quot;UUID&quot;</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;description&quot;</span>      <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;description_hash&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span> <span class="nv">maxlength</span><span class="o">=</span><span class="m">32</span> <span class="nv">generate</span><span class="o">=</span><span class="s2">&quot;always&quot;</span> <span class="nv">generator</span><span class="o">=</span><span class="s2">&quot;method:hashDescription&quot;</span><span class="p">;</span>

    <span class="c">// ...</span>

    <span class="c">// The method will receive a single argument that is the struct</span>
    <span class="c">// of data passed to the insertData() or updateData() methods</span>
    <span class="nv">public</span> <span class="nv">any</span> <span class="nv">function</span> <span class="nf">hashDescription</span><span class="p">(</span> <span class="nv">required</span> <span class="nv">struct</span> <span class="nv">changedData</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nf">changedData.keyExists</span><span class="p">(</span> <span class="s2">&quot;description&quot;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nf">changedData.description.len</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nv">return</span> <span class="nf">Hash</span><span class="p">(</span> <span class="nv">changedData.description</span> <span class="p">);</span>
            <span class="p">}</span>

            <span class="nv">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">return</span><span class="p">;</span> <span class="c">// return NULL to not alter the value when no description is being updated</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div><p>The core system provides you with four named generators:</p>
<ul>
  <li><code>UUID</code> - uses <code>CreateUUId()</code> to generate a UUID for your field. This is used by default for the primary key in preside objects.</li>
  <li><code>timestamp</code> - uses <code>Now()</code> to auto generate a timestamp for your field</li>
  <li><code>hash</code> - used in conjunction with a <code>generateFrom</code> attribute that should be a list of other properties which to concatenate and generate an MD5 hash from</li>
  <li><code>slug</code> - takes an optional <code>generateFrom</code> attribute that defines which field (if present in the submitted data) should be used to generate the slug; by default it will use the object's label field. A unique slug will be generated, so may be suffixed with <code>-1</code>, <code>-2</code>, etc.</li>
</ul><h3>Formula fields</h3><p>Properties that define a formula are not generated as fields in your database tables. Instead, they are made available to your application to be selected in <code>selectData</code> queries. The value of the <code>formula</code> attribute should be a valid SQL statement that can be used in a SQL <code>select</code> statement and include <code>${prefix}</code> tokens before any field definitions (see below for an explanation). For example:</p>
<div class="highlight"><pre><span class="o">/**</span>
 <span class="o">*</span> <span class="err">@</span><span class="nv">datamanagerGridFields</span> <span class="nv">title</span><span class="p">,</span><span class="nv">comment_count</span><span class="p">,</span><span class="nv">datemodified</span>
 <span class="o">*</span>
 <span class="o">*/</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="c">// ...</span>

    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;comments&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;one-to-many&quot;</span> <span class="nv">relatedto</span><span class="o">=</span><span class="s2">&quot;article_comment&quot;</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;comment_count&quot;</span> <span class="nv">formula</span><span class="o">=</span><span class="s2">&quot;Count( distinct ${prefix}comments.id )&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;numeric&quot;</span><span class="p">;</span>

    <span class="c">// ...</span>
<span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span class="nv">articles</span> <span class="o">=</span> <span class="nf">articleDao.selectData</span><span class="p">(</span>
    <span class="nv">selectFields</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;comment_count&quot;</span> <span class="p">]</span>
<span class="p">);</span>
</pre></div><p>Formula fields can also be used in your DataManager data grids and be assigned labels in your object's i18n <code>.properties</code> file.</p>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>Note that formula fields are only selected when <em>explicitly defined</em> in your <code>selectFields</code>. If you leave <code>selectData</code> to return "all" fields, only the properties that are stored in the database will be returned.</p>

					</div>
				</div>
			</div>
		</div><h4>Formula ${prefix} token</h4><p>The <code>${prefix}</code> token in formula fields allows your formula field to be used in more complex select queries that traverse your data model's relationships. Another example, this time a <code>person</code> cfc:</p>
<div class="highlight"><pre><span class="nv">component</span> <span class="p">{</span>
    <span class="c">// ...</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;first_name&quot;</span> <span class="p">...;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;last_name&quot;</span>  <span class="p">...;</span>

    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;full_name&quot;</span> <span class="nv">formula</span><span class="o">=</span><span class="s2">&quot;Concat( ${prefix}first_name, &#39; &#39;, ${prefix}last_name )&quot;</span><span class="p">;</span>
    <span class="c">// ...</span>
<span class="p">}</span>
</pre></div><p>Now, let us imagine we have a company object, with an "employees" <code>one-to-many</code> property that relates to our <code>person</code> object above. We may want to select employees from a company:</p>
<div class="highlight"><pre><span class="k">var</span> <span class="nv">employees</span> <span class="o">=</span> <span class="nf">companyDao.selectData</span><span class="p">(</span>
      <span class="nv">id</span>           <span class="o">=</span> <span class="nv">arguments.companyId</span>
    <span class="p">,</span> <span class="nv">selectFields</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;employees.id&quot;</span><span class="p">,</span> <span class="s2">&quot;employees.full_name&quot;</span> <span class="p">]</span>
<span class="p">);</span>
</pre></div><p>The <code>${prefix}</code> token allows us to take the <code>employees.</code> prefix of the <code>full_name</code> field and replace it so that the final select SQL becomes: <code>Concat( employees.first_name, &#39; &#39;, employees.last_name )</code>. Without a <code>${prefix}</code> token, your formula field will only work when selecting directly from the object in which the property is defined, it will not work when traversing relationships as with the example above.</p><h3>ENUM properties</h3><p>Properties defined with an <code>enum</code> attribute implement an application enforced ENUM system. Named ENUM types are defined in your application's <code>Config.cfc</code> and can then be attributed to a property which then automatically limits and validates the options that are available to the field. ENUM options are saved to the database as a plain string; we avoid any mapping with integer values to keep the implementation portable and simple. Example ENUM definitions in <code>Config.cfc</code>:</p>
<div class="highlight"><pre><span class="nv">settings.enum</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nv">settings.enum.redirectType</span>                <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;301&quot;</span><span class="p">,</span> <span class="s2">&quot;302&quot;</span> <span class="p">];</span>
<span class="nv">settings.enum.pageAccessRestriction</span>       <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;inherit&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="s2">&quot;partial&quot;</span> <span class="p">];</span>
<span class="nv">settings.enum.pageIframeAccessRestriction</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;inherit&quot;</span><span class="p">,</span> <span class="s2">&quot;block&quot;</span><span class="p">,</span> <span class="s2">&quot;sameorigin&quot;</span><span class="p">,</span> <span class="s2">&quot;allow&quot;</span> <span class="p">];</span>
</pre></div><p>In addition to the <code>Config.cfc</code> definition, each ENUM type should have a corresponding <code>.properties</code> file to define the labels and optional description of each item. The file must live at <code>/i18n/enum/{enumTypeId}.properties</code>. For example:</p>
<div class="highlight"><pre><span class="c"># /i18n/enum/redirectType.properties</span>
<span class="na">301.label</span><span class="o">=</span><span class="s">301 Moved Permanently</span>
<span class="na">301.description</span><span class="o">=</span><span class="s">A 301 redirect indicates that the resource has been *permanently* moved to the new locations. This is particularly important to use for moved content as it instructs search engines to index the new location, potentially without losing any SEO rankings. Browsers will aggressively cache these redirects to avoid wasted calls to a URL that it has been told is moved.</span>

<span class="na">302.label</span><span class="o">=</span><span class="s">302 Found (Temporary redirect)</span>
<span class="na">302.description</span><span class="o">=</span><span class="s">A 302 redirect indicates that the resource has been *temporarily* moved to the new location. Use this only when you know that you will/might reinstate the original source URL at some point in time.</span>
</pre></div><h3>Defining relationships with properties</h3><p>Relationships are defined on <strong>property</strong> tags using the <code>relationship</code> and <code>relatedTo</code> attributes. For example:</p>
<div class="highlight"><pre><span class="c">// eventCategory.cfc</span>
<span class="nv">component</span> <span class="p">{}</span>

<span class="c">// event.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;category&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-one&quot;</span> <span class="nv">relatedto</span><span class="o">=</span><span class="s2">&quot;eventCategory&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p>If you do not specify a <code>relatedTo</code> attribute, the system will assume that the foreign object has the same name as the property field. For example, the two objects below would be related through the <code>eventCategory</code> property of the <code>event</code> object:</p>
<div class="highlight"><pre><span class="c">// eventCategory.cfc</span>
<span class="nv">component</span> <span class="p">{}</span>

<span class="c">// event.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;eventCategory&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-one&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><h4>One to Many relationships</h4><p>In the examples, above, we define a <strong>one to many</strong> style relationship between <code>event</code> and <code>eventCategory</code> by adding a foreign key property to the <code>event</code> object.</p><p>The <code>category</code> property will be created as a field in the <code>event</code> object's database table. Its datatype will be automatically derived from the primary key field in the <code>eventCategory</code> object and a Foreign Key constraint will be created for you.</p>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>The <code>event</code> object lives on the <strong>many</strong> side of this relationship (there are <em>many events</em> to <em>one category</em>), hence why we use the relationship type, <em>many-to-one</em>.</p>

					</div>
				</div>
			</div>
		</div><p>You can also declare the relationship on the other side (i.e. the 'one' side). This will allow you to traverse the relationship from either angle. e.g. we could add a 'one-to-many' property on the <code>eventCategory.cfc</code> object; this will not create a field in the database table, but will allow you to query the relationship from the category viewpoint:</p>
<div class="highlight"><pre><span class="c">// eventCategory.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="c">// note that the &#39;relationshipKey&#39; property is the FK in the event object</span>
    <span class="c">// this will default to the name of this object</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;events&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;one-to-many&quot;</span> <span class="nv">relatedTo</span><span class="o">=</span><span class="s2">&quot;event&quot;</span> <span class="nv">relationshipKey</span><span class="o">=</span><span class="s2">&quot;eventCategory&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">// event.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;eventCategory&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-one&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><h4>Many to Many relationships</h4><p>If we wanted an event to be associated with multiple event categories, we would want to use a <strong>Many to Many</strong> relationship:</p>
<div class="highlight"><pre><span class="c">// eventCategory.cfc</span>
<span class="nv">component</span> <span class="p">{}</span>

<span class="c">// event.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;eventCategory&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-many&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p>In this scenario, there will be no <code>eventCategory</code> field created in the database table for the <code>event</code> object. Instead, a "pivot" database table will be automatically created that looks a bit like this (in MySQL):</p>
<div class="highlight"><pre><span class="c1">-- table name derived from the two related objects, delimited by __join__</span>
<span class="k">create</span> <span class="k">table</span> <span class="o">`</span><span class="n">pobj_event__join__eventcategory</span><span class="o">`</span> <span class="p">(</span>
    <span class="c1">-- table simply has a field for each related object</span>
      <span class="o">`</span><span class="n">event</span><span class="o">`</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>
    <span class="p">,</span> <span class="o">`</span><span class="n">eventcategory</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>

    <span class="c1">-- plus we always add a sort_order column, should you care about</span>
    <span class="c1">-- the order in which records are related</span>
    <span class="p">,</span> <span class="o">`</span><span class="n">sort_order</span><span class="o">`</span>    <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>     <span class="k">default</span> <span class="k">null</span>

    <span class="c1">-- unique index on the event and eventCategory fields</span>
    <span class="p">,</span> <span class="k">unique</span> <span class="k">key</span> <span class="o">`</span><span class="n">ux_event__join__eventcategory</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">event</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">eventcategory</span><span class="o">`</span><span class="p">)</span>

    <span class="c1">-- foreign key constraints on the event and eventCategory fields</span>
    <span class="p">,</span> <span class="k">constraint</span> <span class="o">`</span><span class="n">fk_1</span><span class="o">`</span> <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="o">`</span><span class="n">event</span><span class="o">`</span>        <span class="p">)</span> <span class="k">references</span> <span class="o">`</span><span class="n">pobj_event</span><span class="o">`</span>         <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span> <span class="k">on</span> <span class="k">update</span> <span class="k">cascade</span>
    <span class="p">,</span> <span class="k">constraint</span> <span class="o">`</span><span class="n">fk_2</span><span class="o">`</span> <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="o">`</span><span class="n">eventcategory</span><span class="o">`</span><span class="p">)</span> <span class="k">references</span> <span class="o">`</span><span class="n">pobj_eventcategory</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span> <span class="k">on</span> <span class="k">update</span> <span class="k">cascade</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="p">;</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>Unlike <strong>many to one</strong> relationships, the <strong>many to many</strong> relationship can be defined on either or both objects in the relationship. That said, you will want to define it on the object(s) that make use of the relationship. In the event / eventCategory example, this will most likely be the event object. i.e. <code>event.insertData( label=eventName, eventCategory=listOfCategoryIds )</code>.</p>

					</div>
				</div>
			</div>
		</div><h4>"Advanced" Many to Many relationships</h4><p>You can excert a little more control over your many-to-many relationships by making use of some extra, non-required, attributes:</p>
<div class="highlight"><pre><span class="c">// event.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span>                 <span class="o">=</span> <span class="s2">&quot;eventCategory&quot;</span>
             <span class="nv">relationship</span>         <span class="o">=</span> <span class="s2">&quot;many-to-many&quot;</span>
             <span class="nv">relatedTo</span>            <span class="o">=</span> <span class="s2">&quot;eventCategory&quot;</span>
             <span class="nv">relationshipIsSource</span> <span class="o">=</span> <span class="nv">false</span>              <span class="c">// the event object is regarded as the &#39;target&#39; side of the relationship rather than the &#39;source&#39; (default is &#39;source&#39; when relationship defined in the object)</span>
             <span class="nv">relatedVia</span>           <span class="o">=</span> <span class="s2">&quot;event_categories&quot;</span> <span class="c">// create a new auto pivot object called &quot;event_categories&quot; rather than the default &quot;event__join__eventCategory&quot;</span>
             <span class="nv">relatedViaSourceFk</span>   <span class="o">=</span> <span class="s2">&quot;cat&quot;</span>              <span class="c">// name the foreign key field to the source object (eventCategory) to be just &#39;cat&#39;</span>
             <span class="nv">relatedViaTargetFk</span>   <span class="o">=</span> <span class="s2">&quot;ev&quot;</span><span class="p">;</span>              <span class="c">// name the foreign key field to the target object (event) to be just &#39;ev&#39;</span>
<span class="p">}</span>
</pre></div><p>TODO: explain these in more detail. In short though, these attributes control the names of the pivot table and foreign keys that get automatically created for you. If you leave them out, PresideCMS will figure out sensible defaults for you.</p><p>As well as controlling the automatically created pivot table name with "relatedVia", you can also use this attribute to define a relationship that exists through a pre-existing pivot object.</p>
<div class="card-wrap">
			<div class="card card-green">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Tip</p>
						<p>If you have multiple many-to-many relationships between the same two objects, you will <strong>need</strong> to use the <code>relatedVia</code> attribute to ensure that a different pivot table is created for each context.</p>

					</div>
				</div>
			</div>
		</div><h3>Defining indexes and unique constraints</h3><p>The Preside Object system allows you to define database indexes on your fields using the <code>indexes</code> and <code>uniqueindexes</code> attributes. The attributes expect a comma separated list of index definitions. An index definition can be either an index name or combination of index name and field position, separated by a pipe character. For example:</p>
<div class="highlight"><pre><span class="c">// event.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;category&quot;</span> <span class="nv">indexes</span><span class="o">=</span><span class="s2">&quot;category,categoryName|1&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-one&quot;</span> <span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span>     <span class="nv">indexes</span><span class="o">=</span><span class="s2">&quot;categoryName|2&quot;</span>          <span class="nv">required</span><span class="o">=</span><span class="nv">true</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;varchar&quot;</span> <span class="nv">maxlength</span><span class="o">=</span><span class="s2">&quot;100&quot;</span><span class="p">;</span>
    <span class="c">// ...</span>
<span class="p">}</span>
</pre></div><p>The example above would result in the following index definitions:</p>
<div class="highlight"><pre><span class="k">create</span> <span class="k">index</span> <span class="n">ix_category</span>     <span class="k">on</span> <span class="n">pobj_event</span><span class="p">(</span> <span class="n">category</span> <span class="p">);</span>
<span class="k">create</span> <span class="k">index</span> <span class="n">ix_categoryName</span> <span class="k">on</span> <span class="n">pobj_event</span><span class="p">(</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span> <span class="p">);</span>
</pre></div><p>The exact same syntax applies to unique indexes, the only difference being the generated index names are prefixed with <code>ux_</code> rather than <code>ix_</code>.</p><h2>Keeping in sync with the database</h2><p>When you reload your application, the system will attempt to synchronize your object definitions with the database. While it does a reasonably good job at doing this, there are some considerations:</p>
<ul>
  <li><p>If you add a new, required, field to an object that has existing data in the database, an exception will be raised. This is because you cannot add a <code>NOT NULL</code> field to a table that already has data. <em>You will need to provide upgrade scripts to make this type of change to an existing system.</em></p></li>
  <li><p>When you delete properties from your objects, the system will rename the field in the database to <code>_deprecated_yourfield</code>. This prevents accidental loss of data but can lead to a whole load of extra fields in your DB during development.</p></li>
  <li><p>The system never deletes whole tables from your database, even when you delete the object file</p></li>
</ul><h2>Working with the API</h2><p>The <code>PresideObjectService</code> service object provides methods for performing CRUD operations on the data along with other useful methods for querying the metadata of each of your data objects. There are two ways in which to interact with the API:</p>
<ol>
  <li>Obtain an instance the <code>PresideObjectService</code> and call its methods directly</li>
  <li>Obtain an "auto service object" for the specific object you wish to work with and call its decorated CRUD methods as well as any of its own custom methods</li>
</ol><p>You may find that all you wish to do is to render a view with some data that is stored through the Preside Object service. In this case, you can bypass the service layer APIs and use the <a class="missing-link">presidedataobjectviews</a> system instead.</p><h3>Getting an instance of the Service API</h3><p>We use <a href="http://wiki.coldbox.org/wiki/WireBox.cfm">Wirebox</a> to auto wire our service layer. To inject an instance of the service API into your service objects and/or handlers, you can use wirebox's "inject" syntax as shown below:</p>
<div class="highlight"><pre><span class="c">// a handler example</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;presideObjectService&quot;</span> <span class="nv">inject</span><span class="o">=</span><span class="s2">&quot;presideObjectService&quot;</span><span class="p">;</span>

    <span class="nv">function</span> <span class="nf">index</span><span class="p">(</span> <span class="nv">event</span><span class="p">,</span> <span class="nv">rc</span><span class="p">,</span> <span class="nv">prc</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">prc.eventRecord</span> <span class="o">=</span> <span class="nf">presideObjectService.selectData</span><span class="p">(</span> <span class="nv">objectName</span><span class="o">=</span><span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="nv">id</span><span class="o">=</span><span class="nv">rc.id</span> <span class="err">?</span><span class="p">:</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>

        <span class="c">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">// a service layer example</span>
<span class="c">// (here at Pixl8, we prefer to inject constructor args over setting properties)</span>
<span class="nv">component</span> <span class="p">{</span>

    <span class="o">/**</span>
     <span class="o">*</span> <span class="err">@</span><span class="nv">presideObjectService.inject</span> <span class="nv">presideObjectService</span>
     <span class="o">*/</span>
     <span class="nv">public</span> <span class="nv">any</span> <span class="nv">function</span> <span class="nf">init</span><span class="p">(</span> <span class="nv">required</span> <span class="nv">any</span> <span class="nv">presideObjectService</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nf">_setPresideObjectService</span><span class="p">(</span> <span class="nv">arguments.presideObjectService</span> <span class="p">);</span>

        <span class="nv">return</span> <span class="nv">this</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nv">public</span> <span class="nv">query</span> <span class="nv">function</span> <span class="nf">getEvent</span><span class="p">(</span> <span class="nv">required</span> <span class="nv">string</span> <span class="nv">id</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">return</span> <span class="nf">_getPresideObjectService</span><span class="p">().</span><span class="nf">selectData</span><span class="p">(</span>
              <span class="nv">objectName</span> <span class="o">=</span> <span class="s2">&quot;event&quot;</span>
            <span class="p">,</span> <span class="nv">id</span>         <span class="o">=</span> <span class="nv">arguments.id</span>
        <span class="p">);</span>
     <span class="p">}</span>

     <span class="c">// we prefer private getters and setters for accessing private properties, this is our house style</span>
     <span class="nv">private</span> <span class="nv">any</span> <span class="nv">function</span> <span class="nf">_getPresideObjectService</span><span class="p">()</span> <span class="p">{</span>
         <span class="nv">return</span> <span class="nv">variables._presideObjectService</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="nv">private</span> <span class="nv">void</span> <span class="nv">function</span> <span class="nf">_setPresideObjectService</span><span class="p">(</span> <span class="nv">required</span> <span class="nv">any</span> <span class="nv">presideObjectService</span> <span class="p">)</span> <span class="p">{</span>
         <span class="nv">variables._presideObjectService</span> <span class="o">=</span> <span class="nv">arguments.presideObjectService</span><span class="p">;</span>
     <span class="p">}</span>

<span class="p">}</span>
</pre></div><h3>Using Auto Service Objects</h3><p>An auto service object represents an individual data object. They are an instance of the given object that has been decorated with the service API CRUD methods.</p><p>Calling the CRUD methods works in the same way as with the main API with the exception that the objectName argument is no longer required. So:</p>
<div class="highlight"><pre><span class="nv">record</span> <span class="o">=</span> <span class="nf">presideObjectService.selectData</span><span class="p">(</span> <span class="nv">objectName</span><span class="o">=</span><span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="nv">id</span><span class="o">=</span><span class="nv">id</span> <span class="p">);</span>

<span class="c">// is equivalent to:</span>
<span class="nv">eventObject</span> <span class="o">=</span> <span class="nf">presideObjectService.getObject</span><span class="p">(</span> <span class="s2">&quot;event&quot;</span> <span class="p">);</span>
<span class="nv">record</span>      <span class="o">=</span> <span class="nf">eventObject.selectData</span><span class="p">(</span> <span class="nv">id</span><span class="o">=</span><span class="nv">id</span> <span class="p">);</span>
</pre></div><h4>Getting an auto service object</h4><p>This can be done using either the <code>getObject()</code> method of the Preside Object Service or by using a special Wirebox DSL injection syntax, i.e.</p>
<div class="highlight"><pre><span class="c">// a handler example</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;eventObject&quot;</span> <span class="nv">inject</span><span class="o">=</span><span class="s2">&quot;presidecms:object:event&quot;</span><span class="p">;</span>

    <span class="nv">function</span> <span class="nf">index</span><span class="p">(</span> <span class="nv">event</span><span class="p">,</span> <span class="nv">rc</span><span class="p">,</span> <span class="nv">prc</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">prc.eventRecord</span> <span class="o">=</span> <span class="nf">eventObject.selectData</span><span class="p">(</span> <span class="nv">id</span><span class="o">=</span><span class="nv">rc.id</span> <span class="err">?</span><span class="p">:</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>

        <span class="c">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">// a service layer example</span>
<span class="nv">component</span> <span class="p">{</span>

    <span class="o">/**</span>
     <span class="o">*</span> <span class="err">@</span><span class="nv">eventObject.inject</span> <span class="nv">presidecms</span><span class="p">:</span><span class="nv">object</span><span class="p">:</span><span class="nv">event</span>
     <span class="o">*/</span>
     <span class="nv">public</span> <span class="nv">any</span> <span class="nv">function</span> <span class="nf">init</span><span class="p">(</span> <span class="nv">required</span> <span class="nv">any</span> <span class="nv">eventObject</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nf">_setPresideObjectService</span><span class="p">(</span> <span class="nv">arguments.eventObject</span> <span class="p">);</span>

        <span class="nv">return</span> <span class="nv">this</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nv">public</span> <span class="nv">query</span> <span class="nv">function</span> <span class="nf">getEvent</span><span class="p">(</span> <span class="nv">required</span> <span class="nv">string</span> <span class="nv">id</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">return</span> <span class="nf">_getEventObject</span><span class="p">().</span><span class="nf">selectData</span><span class="p">(</span> <span class="nv">id</span> <span class="o">=</span> <span class="nv">arguments.id</span> <span class="p">);</span>
     <span class="p">}</span>

     <span class="c">// we prefer private getters and setters for accessing private properties, this is our house style</span>
     <span class="nv">private</span> <span class="nv">any</span> <span class="nv">function</span> <span class="nf">_getEventObject</span><span class="p">()</span> <span class="p">{</span>
         <span class="nv">return</span> <span class="nv">variables._eventObject</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="nv">private</span> <span class="nv">void</span> <span class="nv">function</span> <span class="nf">_setEventObject</span><span class="p">(</span> <span class="nv">required</span> <span class="nv">any</span> <span class="nv">eventObject</span> <span class="p">)</span> <span class="p">{</span>
         <span class="nv">variables._eventObject</span> <span class="o">=</span> <span class="nv">arguments.eventObject</span><span class="p">;</span>
     <span class="p">}</span>

<span class="p">}</span>
</pre></div><h3>CRUD Operations</h3><p>The service layer provides core methods for creating, reading, updating and deleting records (see individual method documentation for reference and examples):</p>
<ul>
  <li><a href="reference/api/presideobjectservice/selectdata.html">selectData()</a></li>
  <li><a href="reference/api/presideobjectservice/insertdata.html">insertData()</a></li>
  <li><a href="reference/api/presideobjectservice/updatedata.html">updateData()</a></li>
  <li><a href="reference/api/presideobjectservice/deletedata.html">deleteData()</a></li>
</ul><p>In addition to the four core methods above, there are also further utility methods for specific scanarios:</p>
<ul>
  <li><a href="reference/api/presideobjectservice/dataexists.html">dataExists()</a></li>
  <li><a href="reference/api/presideobjectservice/selectmanytomanydata.html">selectManyToManyData()</a></li>
  <li><a href="reference/api/presideobjectservice/syncmanytomanydata.html">syncManyToManyData()</a></li>
  <li><a href="reference/api/presideobjectservice/getdenormalizedmanytomanydata.html">getDeNormalizedManyToManyData()</a></li>
  <li><a href="reference/api/presideobjectservice/getrecordversions.html">getRecordVersions()</a></li>
  <li><a href="reference/api/presideobjectservice/insertdatafromselect.html">insertDataFromSelect()</a></li>
</ul><h4>Specifying fields for selection</h4><p>The <a href="reference/api/presideobjectservice/selectdata.html">selectData()</a> method accepts a <code>selectFields</code> argument that can be used to specify which fields you wish to select. This can be used to select properties on your object as well as properties on related objects and any plain SQL aggregates or other SQL operations. For example:</p>
<div class="highlight"><pre><span class="nv">records</span> <span class="o">=</span> <span class="nf">newsObject.selectData</span><span class="p">(</span>
    <span class="nv">selectFields</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;news.id&quot;</span><span class="p">,</span> <span class="s2">&quot;news.title&quot;</span><span class="p">,</span> <span class="s2">&quot;Concat( category.label, category$tag.label ) as catandtag&quot;</span>  <span class="p">]</span>
<span class="p">);</span>
</pre></div><p>The example above would result in SQL that looked something like:</p>
<div class="highlight"><pre><span class="k">select</span>      <span class="n">news</span><span class="p">.</span><span class="n">id</span>
          <span class="p">,</span> <span class="n">news</span><span class="p">.</span><span class="n">title</span>
          <span class="p">,</span> <span class="n">Concat</span><span class="p">(</span> <span class="n">category</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="n">tag</span><span class="p">.</span><span class="n">label</span> <span class="p">)</span> <span class="k">as</span> <span class="n">catandtag</span>

<span class="k">from</span>        <span class="n">pobj_news</span>     <span class="k">as</span> <span class="n">news</span>
<span class="k">inner</span> <span class="k">join</span>  <span class="n">pobj_category</span> <span class="k">as</span> <span class="n">category</span> <span class="k">on</span> <span class="n">category</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">news</span><span class="p">.</span><span class="n">category</span>
<span class="k">inner</span> <span class="k">join</span>  <span class="n">pobj_tag</span>      <span class="k">as</span> <span class="n">tag</span>      <span class="k">on</span> <span class="n">tag</span><span class="p">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">category</span><span class="p">.</span><span class="n">tag</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>The funky looking <code>category$tag.label</code> is expressing a field selection across related objects - in this case <strong>news</strong> -&gt; <strong>category</strong> -&gt; <strong>tag</strong>. See relationships, below, for full details.</p>

					</div>
				</div>
			</div>
		</div><h4>Filtering data</h4><p>All but the <strong>insertData()</strong> methods accept a data filter to either refine the returned recordset or the records to be updated / deleted. The API provides two arguments for filtering, <code>filter</code> and <code>filterParams</code>. Depending on the type of filtering you need, the <code>filterParams</code> argument will be optional.</p><h5>Simple filtering</h5><p>A simple filter consists of one or more strict equality checks, all of which must be true. This can be expressed as a simple CFML structure; the structure keys represent the object fields; their values represent the expected record values:</p>
<div class="highlight"><pre><span class="nv">records</span> <span class="o">=</span> <span class="nf">newsObject.selectData</span><span class="p">(</span> <span class="nv">filter</span><span class="o">=</span><span class="p">{</span>
      <span class="nv">category</span>             <span class="o">=</span> <span class="nv">chosenCategory</span>
    <span class="p">,</span> <span class="s2">&quot;category$tag.label&quot;</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
<span class="p">}</span> <span class="p">);</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>The funky looking <code>category$tag.label</code> is expressing a filter across related objects - in this case <strong>news</strong> -&gt; <strong>category</strong> -&gt; <strong>tag</strong>. We are filtering news items whos category is tagged with a tag whose label field = "red".</p>

					</div>
				</div>
			</div>
		</div><h5>Complex filters</h5><p>More complex filters can be achieved with a plain SQL filter combined with filter params to make use of parametized SQL statements:</p>
<div class="highlight"><pre><span class="nv">records</span> <span class="o">=</span> <span class="nf">newsObject.selectData</span><span class="p">(</span>
      <span class="nv">filter</span>       <span class="o">=</span> <span class="s2">&quot;category != :category and DateDiff( publishdate, :publishdate ) &gt; :daysold and category$tag.label = :category$tag.label&quot;</span>
    <span class="p">,</span> <span class="nv">filterParams</span> <span class="o">=</span> <span class="p">{</span>
           <span class="nv">category</span>             <span class="o">=</span> <span class="nv">chosenCategory</span>
         <span class="p">,</span> <span class="nv">publishdate</span>          <span class="o">=</span> <span class="nv">publishDateFilter</span>
         <span class="p">,</span> <span class="s2">&quot;category$tag.label&quot;</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
         <span class="p">,</span> <span class="nv">daysOld</span>              <span class="o">=</span> <span class="p">{</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="nv">value</span><span class="o">=</span><span class="m">3</span> <span class="p">}</span>
      <span class="p">}</span>
<span class="p">);</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>Notice that all but the <em>daysOld</em> filter param do not specify a datatype. This is because the parameters can be mapped to fields on the object/s and their data types derived from there. The <em>daysOld</em> filter has no field mapping and so its data type must also be defined here.</p>

					</div>
				</div>
			</div>
		</div><h4>Making use of relationships</h4><p>As seen in the examples above, you can use a special field syntax to reference properties in objects that are related to the object that you are selecting data from / updating data on. When you do this, the service layer will automatically create the necessary SQL joins for you.</p><p>The syntax takes the form: <code>(relatedObjectReference).(propertyName)</code>. The related object reference can either be the name of the related object, or a <code>$</code> delimited path of property names that navigate through the relationships (see examples below).</p><p>This syntax can be used in:</p>
<ul>
  <li>Select fields</li>
  <li>Filters</li>
  <li>Order by statements</li>
  <li>Group by statements</li>
</ul><p>To help with the examples, we'll illustrate a simple relationship between three objects:</p>
<div class="highlight"><pre><span class="c">// tag.cfc</span>
<span class="nv">component</span> <span class="p">{}</span>

<span class="c">// category.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;category_tag&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-one&quot;</span> <span class="nv">relatedto</span><span class="o">=</span><span class="s2">&quot;tag&quot;</span>  <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;news_items&quot;</span>   <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;one-to-many&quot;</span> <span class="nv">relatedTo</span><span class="o">=</span><span class="s2">&quot;news&quot;</span> <span class="nv">relationshipKey</span><span class="o">=</span><span class="s2">&quot;news_category&quot;</span><span class="p">;</span>
    <span class="c">// ..</span>
<span class="p">}</span>

<span class="c">// news.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;news_category&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-one&quot;</span> <span class="nv">relatedto</span><span class="o">=</span><span class="s2">&quot;category&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
    <span class="c">// ..</span>
<span class="p">}</span>
</pre></div><h5>Auto join example</h5>
<div class="highlight"><pre><span class="c">// update news items whose category tag = &quot;red&quot;</span>
<span class="nf">presideObjectService.updateData</span><span class="p">(</span>
      <span class="nv">objectName</span> <span class="o">=</span> <span class="s2">&quot;news&quot;</span>
    <span class="p">,</span> <span class="nv">data</span>       <span class="o">=</span> <span class="p">{</span> <span class="nv">archived</span> <span class="o">=</span> <span class="nv">true</span> <span class="p">}</span>
    <span class="p">,</span> <span class="nv">filter</span>     <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;tag.label&quot;</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span> <span class="p">}</span> <span class="c">// the system will automatically figure out the relationship path between the news object and the tag object</span>
<span class="p">);</span>
</pre></div><h5>Property name examples</h5>
<div class="highlight"><pre><span class="c">// delete news items whose category label = &quot;red&quot;</span>
<span class="nf">presideObjectService.deleteData</span><span class="p">(</span>
      <span class="nv">objectName</span> <span class="o">=</span> <span class="s2">&quot;news&quot;</span>
    <span class="p">,</span> <span class="nv">data</span>       <span class="o">=</span> <span class="p">{</span> <span class="nv">archived</span> <span class="o">=</span> <span class="nv">true</span> <span class="p">}</span>
    <span class="p">,</span> <span class="nv">filter</span>     <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;news_category.label&quot;</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span> <span class="p">}</span>
<span class="p">);</span>

<span class="c">// select title and category tag from all news objects, order by the category tag</span>
<span class="nf">presideObjectService.selectData</span><span class="p">(</span>
      <span class="nv">objectName</span>   <span class="o">=</span> <span class="s2">&quot;news&quot;</span>
    <span class="p">,</span> <span class="nv">selectFields</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;news.title&quot;</span><span class="p">,</span> <span class="s2">&quot;news_category$category_tag.label as tag&quot;</span> <span class="p">]</span>
    <span class="p">,</span> <span class="nv">orderby</span>      <span class="o">=</span> <span class="s2">&quot;news_category$category_tag.label&quot;</span>
<span class="p">);</span>

<span class="c">// selecting categories with a count of news articles for each category</span>
<span class="nf">presideObjectService.selectData</span><span class="p">(</span>
      <span class="nv">objectName</span>   <span class="o">=</span> <span class="s2">&quot;category&quot;</span>
    <span class="p">,</span> <span class="nv">selectFields</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;category.label&quot;</span><span class="p">,</span> <span class="s2">&quot;Count( news_items.id ) as news_item_count&quot;</span> <span class="p">]</span>
    <span class="p">,</span> <span class="nv">orderBy</span>      <span class="o">=</span> <span class="s2">&quot;news_item_count desc&quot;</span>
<span class="p">);</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-yellow">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Warning</p>
						<p>While the auto join syntax can be really useful, it is limited to cases where there is only a single relationship path between the two objects. If there are multiple ways in which you could join the two objects, the system can have no way of knowing which path it should take and will throw an error.</p>

					</div>
				</div>
			</div>
		</div><h4>Caching</h4><p>By default, all <a href="reference/api/presideobjectservice/selectdata.html">selectData()</a> calls have their recordset results cached. These caches are automatically cleared when the data changes.</p><p>You can specify <em>not</em> to cache results with the <code>useCache</code> argument.</p><h2>Extending Objects</h2>
<div class="card-wrap">
			<div class="card card-green">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Tip</p>
						<p>You can easily extend core data objects and objects that have been provided by extensions simply by creating <code>.cfc</code> file with the same name.</p>

					</div>
				</div>
			</div>
		</div><p>Objects with the same name, but from different sources, are merged at runtime so that you can have multiple extensions all contributing to the final object definition.</p><p>Take the <code>page</code> object, for example. You might write an extension that adds an <strong>allow_comments</strong> property to the object. That CFC would look like this:</p>
<div class="highlight"><pre><span class="c">// /extensions/myextension/preside-objects/page.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;allow_comments&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;boolean&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;boolean&quot;</span> <span class="nv">required</span><span class="o">=</span><span class="nv">false</span> <span class="k">default</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p>After adding that code and reloading your application, you would find that the <strong>psys_page</strong> table now had an <strong>allow_comments</strong> field added.</p><p>Then, in your site, you may have some client specific requirements that you need to implement for all pages. Simply by creating a <code>page.cfc</code> file under your site, you can mix in properties along with the <strong>allow_comments</strong> mixin above:</p>
<div class="highlight"><pre><span class="c">// /application/preside-objects/page.cfc</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="c">// remove a property that has been defined elsewhere</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;embargo_date&quot;</span> <span class="nv">deleted</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>

    <span class="c">// alter attributes of an existing property</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;title&quot;</span> <span class="nv">maxLength</span><span class="o">=</span><span class="s2">&quot;50&quot;</span><span class="p">;</span> <span class="c">// strict client requirement?!</span>

    <span class="c">// add a new property</span>
    <span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;search_engine_boost&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;numeric&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;integer&quot;</span> <span class="nv">minValue</span><span class="o">=</span><span class="m">0</span> <span class="nv">maxValue</span><span class="o">=</span><span class="m">100</span> <span class="k">default</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-blue">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Info</p>
						<p>To have your object changes reflected in GUI forms (i.e. the add and edit page forms in the example above), you will likely need to modify the form definitions for the object you have changed.</p>

					</div>
				</div>
			</div>
		</div><h2>Versioning</h2><p>By default, Preside Data Objects will maintain a version history of each database record. It does this by creating a separate database table that is prefixed with <code>_version_</code>. For example, for an object named 'news', a version table named **_version_pobj_news** would be created.</p><p>The version history table contains the same fields as its twin as well as a few specific fields for dealing with version numbers, etc. All foreign key constraints and unique indexes are removed.</p><h3>Opting out</h3><p>To opt out of versioning for an object, you can set the <code>versioned</code> attribute to <strong>false</strong> on your CFC file:</p>
<div class="highlight"><pre><span class="o">/**</span>
 <span class="o">*</span> <span class="err">@</span><span class="nv">versioned</span> <span class="nv">false</span>
 <span class="o">*</span>
 <span class="o">*/</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="c">// ...</span>
<span class="p">}</span>
</pre></div><h3>Interacting with versions</h3><p>Various admin GUIs such as the :doc:<code>datamanager</code> implement user interfaces to deal with versioning records. However, if you find the need to create your own, or need to deal with version history records in any other way, you can use methods provided by the service api:</p>
<ul>
  <li><a href="reference/api/presideobjectservice/getrecordversions.html">getRecordVersions()</a></li>
  <li><a href="reference/api/presideobjectservice/getversionobjectname.html">getVersionObjectName()</a></li>
  <li><a href="reference/api/presideobjectservice/objectisversioned.html">objectIsVersioned()</a></li>
  <li><a href="reference/api/presideobjectservice/getnextversionnumber.html">getNextVersionNumber()</a></li>
</ul><p>In addition, you can specify whether or not you wish to use the versioning system, and also what version number to use if you are, when calling the <a href="reference/api/presideobjectservice/insertdata.html">insertData()</a>, <a href="reference/api/presideobjectservice/updatedata.html">updateData()</a> and <a href="reference/api/presideobjectservice/deletedata.html">deleteData()</a> methods by using the <code>useVersioning</code> and <code>versionNumber</code> arguments.</p><p>Finally, you can select data from the version history tables with the <a href="reference/api/presideobjectservice/selectdata.html">selectData()</a> method by using the <code>fromVersionTable</code>, <code>maxVersion</code> and <code>specificVersion</code> arguments.</p><h3>Many-to-many related data</h3><p>By default, auto generated <code>many-to-many</code> data tables will be versioned along with your record changes. You can opt out of this by adding a <code>versioned=false</code> attribute to the <code>many-to-many</code> property:</p>
<div class="highlight"><pre><span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;categories&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-many&quot;</span> <span class="nv">relatedTo</span><span class="o">=</span><span class="s2">&quot;category&quot;</span> <span class="nv">versioned</span><span class="o">=</span><span class="nv">false</span><span class="p">;</span>
</pre></div><p>Inversely, you may have a <code>many-to-many</code> relationship for which you have an explicit join table that you'd like versioned along with the parent record. In this scenario, you can explicitly set <code>versioned=true</code>:</p>
<div class="highlight"><pre><span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;categories&quot;</span> <span class="nv">relationship</span><span class="o">=</span><span class="s2">&quot;many-to-many&quot;</span> <span class="nv">relatedTo</span><span class="o">=</span><span class="s2">&quot;category&quot;</span> <span class="nv">relatedVia</span><span class="o">=</span><span class="s2">&quot;explicit_categories_obj&quot;</span> <span class="nv">versioned</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
</pre></div><h3>Ignoring changes</h3><p>By default, when the data actually changes in your object, a new version will be created. If you wish certain fields to be ignored when it comes to determining whether or not a new version should be created, you can add a <code>ignoreChangesForVersioning</code> attribute to the property in the preside object.</p><p>An example scenario for this might be an object whose data is synced with an external source on a schedule. You may add a helper property to record the last sync check date, if no other fields have changed, you probably don't want a new version record being created just for that sync check date. In this case, you could do:</p>
<div class="highlight"><pre><span class="nv">property</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;_last_sync_check&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;date&quot;</span> <span class="nv">dbtype</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span> <span class="nv">ignoreChangesForVersioning</span><span class="o">=</span><span class="nv">true</span><span class="p">;</span>
</pre></div><h3>Only create versions on update</h3><p>As of <strong>10.9.0</strong>, you are able to specify that a version record is <strong>not</strong> created on <strong>insert</strong>. Instead, the first version record will be created on the first update to the record. This allows you to save on unnecessary version records in your database. To do this, add the <code>versionOnInsert=false</code> attribute to you object, e.g.</p>
<div class="highlight"><pre><span class="o">/**</span>
 <span class="o">*</span> <span class="err">@</span><span class="nv">versioned</span>       <span class="nv">true</span>
 <span class="o">*</span> <span class="err">@</span><span class="nv">versionOnInsert</span> <span class="nv">false</span>
 <span class="o">*/</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="c">// ...</span>
<span class="p">}</span>
</pre></div><h2>Organising data by sites</h2><p>You can instruct the Preside Data Objects system to organise your objects' data into your system's individual sites (see <a href="devguides/workingwithmultiplesites.html">Working with multiple sites</a>). Doing so will mean that any data reads and writes will be specific to the currently active site.</p><p>To enable this feature for an object, simply add the <code>siteFiltered</code> attribute to the <code>component</code> tag:</p>
<div class="highlight"><pre><span class="o">/**</span>
 <span class="o">*</span> <span class="err">@</span><span class="nv">siteFiltered</span> <span class="nv">true</span>
 <span class="o">*</span>
 <span class="o">*/</span>
<span class="nv">component</span> <span class="p">{</span>
    <span class="c">// ...</span>
<span class="p">}</span>
</pre></div>
<div class="card-wrap">
			<div class="card card-yellow">
				<aside class="card-side">
					<span class="card-heading icon icon-info"></span>
				</aside>
				<div class="card-main">
					<div class="card-inner">
						<p class="card-heading">Warning</p>
						<p>As of Preside 10.8.0, this method is deprecated and you should instead use <code>@tenant site</code>. See <a href="devguides/datatenancy.html">Configuring data tenancy</a>.</p>

					</div>
				</div>
			</div>
		</div>


						</div>
					</div>
				</div>
			</div>
		</div>

		<footer class="footer">
			<div class="container">
				<p>The PresideCMS Documentation is developed and maintained by Pixl8 Interactive and is licensed under a
					<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png"></a>
					<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.
				</p>
			</div>
		</footer>

		<script src="assets/js/base.3.min.js" type="text/javascript"></script>
	</body>
</html>